<div class="ViewBody">
  <div class="div-left" style="float: left;">
    <div style="padding-top: 20px;">
      <mat-drawer-container class="container" autosize style="height: 410px">
        <mat-drawer #drawer class="sidenav" mode="side" style="width: 260px">
          <h3><b>Search Mem</b></h3>
          <form class="search-pm-form">
            <mat-form-field class="example-full-width" appearance="fill">
              <mat-label>Member Username</mat-label>
              <!--              <input name="searchMem" matInput [(ngModel)]="searchText">-->
              <input name="key" matInput (ngModelChange)="[textValue=key.value, searchAccount()]"
                     [(ngModel)]="searchText" #key="ngModel" ngModel>
            </mat-form-field>
          </form>
          <hr>
          <h3><b>Filter Project</b></h3>
          <h4 style="margin-bottom: 0; margin-top: 12px;"><b>By State</b></h4>
          <mat-checkbox class="example-margin" [checked]="checkProcessing"
                        (change)="[checkProcessing = !checkProcessing, setFilterByState()]">Processing
          </mat-checkbox>
          <mat-checkbox class="example-margin" [checked]="checkClosed"
                        (change)="[checkClosed = !checkClosed, setFilterByState()]" style="padding-left: 20px;">Closed
          </mat-checkbox>
          <br>
          <mat-checkbox class="example-margin" [checked]="checkPending"
                        (change)="[checkPending = !checkPending, setFilterByState()]">Pending
          </mat-checkbox>
          <br>
          <h4 style="margin-bottom: 0; margin-top: 12px;"><b>Order by</b></h4>
          <mat-form-field appearance="fill">
            <mat-label>Order by</mat-label>
            <mat-select [(ngModel)]="selectedValue" name="option" (selectionChange)="changeClient($event.value)">
              <mat-option name="choose" *ngFor="let op of ops" [value]="op.value">
                {{op.viewValue}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </mat-drawer>

        <div class="sidenav-content">
          <button class="button-show" type="button" mat-icon-button (click)="drawer.toggle()">
            <i class="fas fa-caret-right"></i>
          </button>
        </div>
      </mat-drawer-container>
    </div>
  </div>

  <div class="div-right" style=" display: flow-root;">
    <div class="tree">
      <ul>
        <li>
          <!-- start Node cha -->
          <div class="node" click [ngStyle]="{'background-color': nodeColor('PM')}">
            <div class="node-mask node-padding" (click)="detailEmployee(PM.id)">
              <p>PM</p>
              <hr>
              <div class="avaAndName">
                <img *ngIf="PM?.gender?.toString()==='MALE'" src="{{(PM?.avatar) || '\\assets\\images\\undraw_male_avatar_323b.svg' }}" alt="imgPM">
                <img *ngIf="PM?.gender?.toString()==='FEMALE'" src="{{(PM?.avatar) || '\\assets\\images\\undraw_female_avatar_w3jk.svg' }}" alt="imgPM">
                <div class="name">{{PM?.account?.accountName}}</div>
              </div>
              <div *ngIf="isAdmin" class="oneButton">
                <button mat-raised-button color="primary" (click)="$event.stopPropagation();" [routerLink]="['/project/create']" [queryParams]="{pm:PM?.account?.accountName}" >ADD Project</button>
              </div>
            </div>
          </div>
          <!-- end Node cha -->
          <!-- start node con tầng 2 -->
          <div class="tangCon">
            <ul class="ulClass">

              <!-- node tầng 2 - 1 -->
              <li *ngFor="let pAm of displayProject | slice:0:showProJ; let i = index">
                <div style="max-width: 315px; margin: auto;">
                  <div class="node" (click)="detailProject(pAm.project.id)"
                       [ngStyle]="{'background-color': checkProjectState(pAm.project)}"
                       style=" margin: auto;">
                    <div class="node-mask node-padding">
                      <p>{{pAm.project.name}}</p>
                      <hr>
                      <p class="description"><b>Description: </b>{{pAm.project.description}}</p>
                      <p class="description"><b>State: </b>{{pAm.project.state}}</p>
                      <p class="description"><b>Start date: </b>{{pAm.project.startDate | date: 'dd/MM/yyyy' }}</p>
                      <div *ngIf="isAdmin && pAm.project.state==='PROCESSING'" class="twoButton">
                        <button mat-raised-button color="primary"
                                (click)="addMemberToProject(pAm.project.id);$event.stopPropagation();"
                                class="buttonLeft">Add Mem
                        </button>
                        <button mat-raised-button color="warn"
                                (click)="removeProject(pAm.project);$event.stopPropagation();"
                                class="buttonRight">Remove
                        </button>
                      </div>
                      <div *ngIf="isAdmin && pAm.project.state==='CLOSED'" class="oneButton">
                        <button mat-raised-button color="warn"
                                (click)="removeProject(pAm.project);$event.stopPropagation();"
                                class="buttonRight">Remove
                        </button>
                      </div>
                    </div>
                  </div>
                  <div style="display: flex; flex-direction: column; float: right; padding-left: 5px; padding-top: 20px">
                    <button *ngIf="i==(showProJ-1)  && i < displayProject.length-1"
                            style="margin-bottom: -15px"
                            class="button-show" type="button" mat-icon-button (click)="increaseShowProJ()">
                      <i class="fa fa-angle-right"></i>
                    </button>
                    <button *ngIf=" (i == displayProject.length-1 && i > 1) || (showProJ-1===i && i >1)"
                            style="margin-bottom: -15px"
                            class="button-show" type="button" mat-icon-button (click)="decreaseShowProJ()">
                      <i class="fa fa-angle-left"></i>
                    </button>
                  </div>
                </div>


                <!-- <div *ngIf="getMemberByProjectId(prjId.projectID+'')"> -->
                <div *ngIf="pAm.memberList.length>0">
                  <ul class="ulClass">
                    <li
                      *ngFor="let projectMember of pAm.memberList  | slice:0:showMemMap.get(pAm.project.id); let i=index">
                      <div class="node"
                           [ngStyle]="{'background-color': nodeColor(projectMember.role)}"
                           (click)="detailEmployee(projectMember.employee.id)"
                      >
                        <div class="node-mask node-padding">
                          <p>{{projectMember.role}}</p>
                          <hr>
                          <div class="avaAndName">
                            <img *ngIf="projectMember?.employee?.gender?.toString()==='MALE'" src="{{(projectMember?.employee?.avatar) || '\\assets\\images\\undraw_male_avatar_323b.svg' }}" alt="imgPM">
                            <img *ngIf="projectMember?.employee?.gender?.toString()==='FEMALE'" src="{{(projectMember?.employee?.avatar) || '\\assets\\images\\undraw_female_avatar_w3jk.svg' }}" alt="imgPM">
                            <div class="name">{{getAccountName(projectMember)}}</div>
                          </div>
                          <div *ngIf="isAdmin" class="oneButton">
                            <button mat-raised-button color="warn"
                                    (click)="removeEmployeeFromProject(projectMember.employee.id, pAm.project.id);$event.stopPropagation();">
                              Remove
                            </button>
                          </div>
                        </div>
                      </div>
                      <div style="display: flex; flex-direction: column; float: right; padding-left: 5px; padding-top: 20px">
                        <button *ngIf="i==(showMemMap.get(pAm.project.id)-1)  && (i < pAm.memberList.length-1)"
                                style="margin-bottom: -15px"
                                class="button-show" type="button" mat-icon-button (click)="increaseShowMemValue(pAm.project.id)">
                          <i class="fa fa-angle-right"></i>
                        </button>
                        <button *ngIf="(i === pAm.memberList.length-1 && i > showMem)|| ((showMemMap.get(pAm.project.id)-1)===i && i >1)"
                                style="margin-bottom: -15px"
                                class="button-show" type="button" mat-icon-button (click)="decreaseShowMemValue(pAm.project.id)">
                          <i class="fa fa-angle-left"></i>
                        </button>
                      </div>
                    </li>
                  </ul>

                </div>
              </li>
            </ul>
            <!-- Thêm button more vào thì nhánh cây không cân nữa nên phải thêm padding-left: 40px trong class tang2 để cân -->
            <!-- <button class="moreButton">More</button> -->
          </div>
          <!-- end node con tầng 2 -->
        </li>
      </ul>
    </div>
  </div>
</div>
